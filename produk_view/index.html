<!DOCTYPE html>
<html>
<head>
    <title>Daftar Produk</title>
    <script src="https://unpkg.com/vue@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        input, select { margin-right: 10px; margin-top: 10px; padding: 5px; }
        button { padding: 5px 10px; margin: 5px; }
    </style>
</head>
<body>

<div id="app">
    <h2>Daftar Produk</h2>

    <!-- Search -->
    <input 
        type="text" 
        v-model="keyword" 
        placeholder="Cari produk..."
        @input="refreshPage"
    >

    <!-- Sort -->
    <select v-model="sort_by" @change="refreshData">
        <option value="nama_produk">Nama Produk</option>
        <option value="harga">Harga</option>
        <option value="stok">Stok</option>
    </select>

    <select v-model="sort_dir" @change="refreshData">
        <option value="asc">Asc</option>
        <option value="desc">Desc</option>
    </select>

    <!-- Tabel Produk -->
    <table>
        <thead>
            <tr>
                <th>No</th>
                <th>Nama Produk</th>
                <th>Kategori</th>
                <th>Harga</th>
                <th>Stok</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="(p, i) in produk" :key="p.id">
                <td>{{ (currentPage - 1) * limit + i + 1 }}</td>
                <td>{{ p.nama_produk }}</td>
                <td>{{ p.kategori }}</td>
                <td>{{ p.harga.toLocaleString() }}</td>
                <td>{{ p.stok }}</td>
            </tr>
            <tr v-if="produk.length === 0">
                <td colspan="5" style="text-align:center;">Data tidak ditemukan</td>
            </tr>
        </tbody>
    </table>

    <!-- Pagination -->
    <div style="margin-top: 10px;">
        <button @click="prevPage" :disabled="currentPage == 1">Prev</button>
        Halaman {{ currentPage }} / {{ totalPage }}
        <button @click="nextPage" :disabled="currentPage == totalPage">Next</button>
    </div>
</div>

<script>
const app = Vue.createApp({
    data() {
        return {
            produk: [],
            count: 0,

            keyword: "",
            sort_by: "nama_produk",
            sort_dir: "asc",

            limit: 10,
            currentPage: 1
        };
    },

    computed: {
        totalPage() {
            return Math.ceil(this.count / this.limit) || 1;
        }
    },

    methods: {
        refreshPage() {
            this.currentPage = 1;
            this.fetchData();
        },

        refreshData() {
            this.fetchData();
        },

        fetchData() {
            const start = (this.currentPage - 1) * this.limit;

            axios.get("http://127.0.0.1:8000/api/produk/list", {
                params: {
                    keyword: this.keyword,
                    sort_by: this.sort_by,
                    sort_dir: this.sort_dir,
                    start: start,
                    limit: this.limit
                }
            })
            .then(res => {
                this.produk = res.data.produk;
                this.count  = res.data.count;

                if (this.currentPage > this.totalPage) {
                    this.currentPage = this.totalPage;
                    this.fetchData();
                }
            })
            .catch(err => {
                console.error("Error fetching data:", err);
                this.produk = [];
                this.count = 0;
            });
        },

        nextPage() {
            if (this.currentPage < this.totalPage) {
                this.currentPage++;
                this.fetchData();
            }
        },

        prevPage() {
            if (this.currentPage > 1) {
                this.currentPage--;
                this.fetchData();
            }
        }
    },

    mounted() {
        this.fetchData();
    }
});

app.mount("#app");
</script>

</body>
</html>
